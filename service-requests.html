<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Requests - KNUST VoIP System</title>
    <link rel="icon" type="image/png" href="Gemini favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <meta name="description" content="Request VoIP services from KNUST UITS.">
</head>

<body class="page-service-requests">

    <!-- Global Header -->
    <header class="site-header">
        <div class="header-inner">
            <a href="https://voip.knust.edu.gh/" class="logo-area">
                <img src="voip_logo_new.png" alt="KNUST VoIP Logo" class="logo-img">
            </a>
            <button class="menu-toggle" aria-label="Toggle navigation">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
            <nav class="nav-links">
                <a href="https://voip.knust.edu.gh/">Home</a>
                <a href="about.html">About KVS</a>
                <a href="report-issue.html">Report an Issue</a>
                <a href="service-requests.html" class="active">Request Services</a>
                <a href="#" onclick="openPrintModal(event)">Print</a>
                <a href="services.html">Our Services</a>
                <a href="resources.html">Resources</a>
                <a href="contact.html">Contact Us</a>
            </nav>
            <a href="#" class="admin-area">
                admin
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </a>
        </div>
    </header>

    <div class="page-banner"></div>

    <main class="container">

        <div class="tabs-container fade-in">
            <button class="tab-btn active" onclick="switchTab('submit-request')">Submit Request</button>
            <button class="tab-btn" onclick="switchTab('check-status')">Check Status</button>
            <button class="tab-btn" onclick="switchTab('service-catalog')">Service Catalog</button>
        </div>

        <!-- Section: Submit Request -->
        <section id="submit-request" class="ticket-container report-section active">
            <div class="ticket-header">
                <h2>Submit a Service Request</h2>
                <p>Please fill in the form below to request a VoIP service.</p>
            </div>

            <form id="requestForm" onsubmit="handleRequestSubmission(event)">
                <div id="formMessage" class="form-message" style="display: none;"></div>

                <div class="ticket-form-group">
                    <input type="email" id="email" class="ticket-input" placeholder=" " required>
                    <label class="ticket-label" for="email">Email Address</label>
                </div>

                <div class="ticket-form-group">
                    <input type="text" id="fullName" class="ticket-input" placeholder=" " required>
                    <label class="ticket-label" for="fullName">Full Name</label>
                </div>

                <div class="ticket-form-group">
                    <input type="tel" id="phone" class="ticket-input" placeholder=" " required>
                    <label class="ticket-label" for="phone">Phone Number</label>
                </div>

                <div class="ticket-form-group">
                    <input type="text" id="department" class="ticket-input" placeholder=" " required>
                    <label class="ticket-label" for="department">Department/Unit</label>
                </div>

                <div class="ticket-form-group">
                    <select id="serviceCategory" class="ticket-select" onchange="handleCategoryChange()" required>
                        <option value="" disabled selected></option>
                        <optgroup label="Hardware & Equipment">
                            <option value="gsm_gateway">GSM/PSTN Gateway Devices</option>
                            <option value="ucm_server">Grandstream UCM Servers</option>
                            <option value="handsets">VoIP Handsets</option>
                            <option value="conference_equipment">Conference Room Equipment</option>
                        </optgroup>
                        <optgroup label="Services & Features">
                            <option value="call_cards">External Call Cards</option>
                            <option value="ivr">IVR (Interactive Voice Response)</option>
                            <option value="call_recording">Call Recording</option>
                            <option value="analytics">Call Analytics & Reporting</option>
                            <option value="queue_management">Queue Management</option>
                        </optgroup>
                        <optgroup label="Integration Services">
                            <option value="omnichannel">Omnichannel Contact Center</option>
                            <option value="whatsapp">WhatsApp Business Integration</option>
                            <option value="telegram">Telegram Integration</option>
                            <option value="sms_gateway">Bulk SMS Gateway</option>
                            <option value="email_integration">Email Integration</option>
                            <option value="social_media">Social Media Integration</option>
                        </optgroup>
                        <optgroup label="Quotations & Billing">
                            <option value="service_quote">Service Quotation</option>
                            <option value="hardware_quote">Hardware Quotation</option>
                            <option value="invoice">Invoice Request</option>
                            <option value="custom_quote">Custom Solution Quote</option>
                        </optgroup>
                        <optgroup label="Other Services">
                            <option value="training">Training Request</option>
                            <option value="consultation">Technical Consultation</option>
                            <option value="custom">Custom Request</option>
                        </optgroup>
                    </select>
                    <label class="ticket-label" for="serviceCategory">Service Category</label>
                </div>

                <div class="ticket-form-group">
                    <select id="urgency" class="ticket-select" required>
                        <option value="" disabled selected></option>
                        <option value="low">Low - No rush</option>
                        <option value="medium">Medium - Within 2 weeks</option>
                        <option value="high">High - Within 1 week</option>
                        <option value="critical">Critical - Urgent</option>
                    </select>
                    <label class="ticket-label" for="urgency">Urgency Level</label>
                </div>

                <div class="ticket-form-group">
                    <input type="number" id="quantity" class="ticket-input" placeholder=" " min="1" value="1">
                    <label class="ticket-label" for="quantity">Quantity (if applicable)</label>
                </div>

                <div class="ticket-form-group">
                    <input type="text" id="budgetCode" class="ticket-input" placeholder=" ">
                    <label class="ticket-label" for="budgetCode">Budget Code (optional)</label>
                </div>

                <div class="ticket-form-group">
                    <input type="date" id="preferredDate" class="ticket-input" placeholder=" ">
                    <label class="ticket-label" for="preferredDate">Preferred Implementation Date</label>
                </div>

                <div class="ticket-form-group">
                    <textarea id="description" class="ticket-textarea" placeholder=" " rows="5" required></textarea>
                    <label class="ticket-label" for="description">Detailed Description</label>
                </div>

                <div class="ticket-actions">
                    <button type="submit" class="btn-ticket btn-create">Submit Request</button>
                    <button type="reset" class="btn-ticket btn-reset">Reset</button>
                </div>
            </form>

            <!-- Success State -->
            <div id="successState" class="success-state-container" style="display: none;">
                <div class="success-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                </div>
                <h2>Request Submitted!</h2>
                <div class="ticket-id-display">
                    <span>Request ID:</span>
                    <strong id="displayRequestId">SR1234</strong>
                    <button class="copy-btn" onclick="copyRequestId()" title="Copy ID">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                    </button>
                </div>
                <p>Keep this ID to check your request status later. You'll receive a confirmation email shortly.</p>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn-ticket btn-create" onclick="resetRequestForm()"
                        style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">New Request</button>
                    <button class="btn-ticket btn-reset" onclick="switchTab('check-status')"
                        style="padding: 0.5rem 1.5rem; font-size: 0.9rem;">Check Status</button>
                </div>
            </div>
        </section>

        <!-- Section: Check Status -->
        <section id="check-status" class="ticket-container report-section">
            <div class="ticket-header">
                <h2>Check Request Status</h2>
                <p>Enter your Request ID or Email to check the status of your service request.</p>
            </div>

            <form onsubmit="handleStatusCheck(event)">
                <div class="ticket-form-group">
                    <input type="text" id="statusId" class="ticket-input" placeholder=" " required>
                    <label class="ticket-label" for="statusId">Request ID or Email</label>
                </div>

                <button type="submit" class="btn-ticket btn-create">Check Status</button>
            </form>

            <div id="statusResult" class="status-result" style="display: none;"></div>
        </section>

        <!-- Section: Service Catalog -->
        <section id="service-catalog" class="ticket-container report-section">
            <div class="ticket-header">
                <h2>Service Catalog</h2>
                <p>Browse our available VoIP services and solutions.</p>
            </div>

            <div class="service-catalog-grid">
                <!-- Hardware & Equipment -->
                <div class="service-category-card">
                    <div class="service-icon">üîß</div>
                    <h3>Hardware & Equipment</h3>
                    <ul>
                        <li><strong>GSM/PSTN Gateways</strong> - Connect analog lines to your VoIP system</li>
                        <li><strong>UCM Servers</strong> - Enterprise-grade PBX systems</li>
                        <li><strong>VoIP Handsets</strong> - Professional desk phones</li>
                        <li><strong>Conference Equipment</strong> - Meeting room solutions</li>
                    </ul>
                </div>

                <!-- Services & Features -->
                <div class="service-category-card">
                    <div class="service-icon">‚öôÔ∏è</div>
                    <h3>Services & Features</h3>
                    <ul>
                        <li><strong>Call Cards</strong> - International calling credit</li>
                        <li><strong>IVR Systems</strong> - Automated call menus</li>
                        <li><strong>Call Recording</strong> - Record and archive calls</li>
                        <li><strong>Analytics</strong> - Detailed call reporting</li>
                        <li><strong>Queue Management</strong> - Advanced call routing</li>
                    </ul>
                </div>

                <!-- Integration Services -->
                <div class="service-category-card">
                    <div class="service-icon">üîó</div>
                    <h3>Integration Services</h3>
                    <ul>
                        <li><strong>Omnichannel Platform</strong> - Unified communications</li>
                        <li><strong>WhatsApp Business</strong> - WhatsApp messaging</li>
                        <li><strong>Telegram</strong> - Telegram bot integration</li>
                        <li><strong>Bulk SMS</strong> - SMS gateway services</li>
                        <li><strong>Email & Social Media</strong> - Multi-channel support</li>
                    </ul>
                </div>

                <!-- Quotations & Support -->
                <div class="service-category-card">
                    <div class="service-icon">üìã</div>
                    <h3>Quotations & Support</h3>
                    <ul>
                        <li><strong>Service Quotes</strong> - Pricing for services</li>
                        <li><strong>Hardware Quotes</strong> - Equipment pricing</li>
                        <li><strong>Invoice Requests</strong> - Billing documentation</li>
                        <li><strong>Training</strong> - Staff training programs</li>
                        <li><strong>Consultation</strong> - Technical advisory</li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <!-- Print Modal (reused from other pages) -->
    <div id="printModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal" onclick="closePrintModal()">&times;</span>
            <h2>Digital Print Directory</h2>
            <p>Enter a department or location to generate a printable directory.</p>
            <input type="text" id="printDepartment" class="modal-input"
                placeholder="e.g., Engineering, Hospital, Security">
            <button class="modal-btn" onclick="generatePrintDirectory()">Generate Print Directory</button>
        </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <p>Copyright ¬© 2017 - <span id="currentYear"></span>. VOIP DIRECTORY</p>
    </footer>

    <script>
        // Set current year
        document.getElementById('currentYear').innerText = new Date().getFullYear();

        // Mobile menu toggle
        document.querySelector('.menu-toggle').addEventListener('click', function () {
            document.querySelector('.nav-links').classList.toggle('active');
        });

        // Tab switching
        function switchTab(tabId) {
            // Update buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update sections
            document.querySelectorAll('.report-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
        }

        // Print modal functions
        function openPrintModal(event) {
            event.preventDefault();
            document.getElementById('printModal').style.display = 'block';
        }

        function closePrintModal() {
            document.getElementById('printModal').style.display = 'none';
        }

        function generatePrintDirectory() {
            const dept = document.getElementById('printDepartment').value;
            if (dept) {
                window.open(`print-directory.html?dept=${encodeURIComponent(dept)}`, '_blank');
                closePrintModal();
            } else {
                alert('Please enter a department or location.');
            }
        }

        window.onclick = function (event) {
            const modal = document.getElementById('printModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Service Request System
        const SHEETDB_API_URL_REQUESTS = 'https://sheetdb.io/api/v1/jmq0gt7i5640u'; // TODO: Replace with actual SheetDB URL

        function handleCategoryChange() {
            // Can add dynamic behavior based on category if needed
        }

        async function handleRequestSubmission(event) {
            event.preventDefault();

            const form = event.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            const formMessage = document.getElementById('formMessage');
            const originalBtnText = submitBtn.innerText;

            // UI State: Loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading-spinner"></span> Submitting...';
            formMessage.style.display = 'none';
            formMessage.className = 'form-message';

            const requestId = 'SR' + Math.floor(1000 + Math.random() * 9000);
            const formData = {
                request_id: requestId,
                email: document.getElementById('email').value,
                full_name: document.getElementById('fullName').value,
                phone: document.getElementById('phone').value,
                department: document.getElementById('department').value,
                service_category: document.getElementById('serviceCategory').value,
                urgency: document.getElementById('urgency').value,
                quantity: document.getElementById('quantity').value,
                budget_code: document.getElementById('budgetCode').value,
                preferred_date: document.getElementById('preferredDate').value,
                description: document.getElementById('description').value,
                status: 'Submitted',
                admin_response: '',
                admin_notes: '',
                estimated_cost: '',
                approval_date: '',
                completion_date: '',
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
                email_confirmation_sent: '',
                email_status_update_sent: ''
            };

            try {
                const response = await fetch(SHEETDB_API_URL_REQUESTS, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ data: [formData] })
                });

                const result = await response.json();

                if (response.ok) {
                    // UI State: Success
                    document.getElementById('requestForm').style.display = 'none';
                    document.getElementById('successState').style.display = 'block';
                    document.getElementById('displayRequestId').innerText = requestId;

                    // Smooth scroll to top of section
                    document.getElementById('submit-request').scrollIntoView({ behavior: 'smooth' });
                } else {
                    // UI State: API Error
                    let errorMsg = 'Failed to submit request. ';
                    if (result.error === 'Bad data format') {
                        errorMsg += 'Please contact the administrator.';
                    } else {
                        errorMsg += result.error || 'Server error.';
                    }
                    throw new Error(errorMsg);
                }
            } catch (error) {
                console.error('Error:', error);
                formMessage.innerText = error.message.includes('fetch') ? 'Network error. Please check your connection.' : error.message;
                formMessage.classList.add('error');
                formMessage.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerText = originalBtnText;
            }
        }

        function copyRequestId() {
            const requestId = document.getElementById('displayRequestId').innerText;
            navigator.clipboard.writeText(requestId).then(() => {
                const btn = document.querySelector('.copy-btn');
                const originalSvg = btn.innerHTML;
                btn.innerHTML = '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>';
                setTimeout(() => btn.innerHTML = originalSvg, 2000);
            });
        }

        function resetRequestForm() {
            document.getElementById('requestForm').reset();
            document.getElementById('requestForm').style.display = 'block';
            document.getElementById('successState').style.display = 'none';
            document.getElementById('formMessage').style.display = 'none';
        }

        async function handleStatusCheck(event) {
            event.preventDefault();
            const resultDiv = document.getElementById('statusResult');
            const statusId = document.getElementById('statusId').value.trim();
            const checkBtn = event.target.querySelector('button[type="submit"]');

            checkBtn.disabled = true;
            checkBtn.innerText = 'Checking...';
            resultDiv.style.display = 'none';

            try {
                // Search by request_id or email
                const query = statusId.startsWith('SR') ? `request_id=${statusId}` : `email=${statusId}`;
                const response = await fetch(`${SHEETDB_API_URL_REQUESTS}/search?${query}`);

                if (!response.ok) throw new Error('Search failed');

                const results = await response.json();

                resultDiv.style.display = 'block';
                if (results.length > 0) {
                    const request = results[results.length - 1];
                    const statusClass = getStatusClass(request.status);

                    let adminResponseHtml = '';
                    if (request.admin_response && request.admin_response.trim() !== '') {
                        adminResponseHtml = `
                            <div class="admin-response-box">
                                <div class="admin-response-header">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                                    Admin Response:
                                </div>
                                <div class="admin-response-body">${request.admin_response}</div>
                            </div>
                        `;
                    }

                    let costHtml = '';
                    if (request.estimated_cost && request.estimated_cost.trim() !== '') {
                        costHtml = `<p style="margin-bottom: 0.5rem; color: var(--text-secondary);"><strong>Estimated Cost:</strong> ${request.estimated_cost}</p>`;
                    }

                    resultDiv.innerHTML = `
                        <div class="status-tag ${statusClass}">${request.status || 'Unknown'}</div>
                        <h3 style="color: var(--primary-navy); margin-bottom: 0.5rem;">Request: ${request.request_id}</h3>
                        <p style="margin-bottom: 0.5rem; color: var(--text-secondary);"><strong>Name:</strong> ${request.full_name}</p>
                        <p style="margin-bottom: 0.5rem; color: var(--text-secondary);"><strong>Email:</strong> ${request.email}</p>
                        <p style="margin-bottom: 0.5rem; color: var(--text-secondary);"><strong>Phone:</strong> ${request.phone}</p>
                        <p style="margin-bottom: 0.5rem; color: var(--text-secondary);"><strong>Department:</strong> ${request.department}</p>
                        <p style="margin-bottom: 0.5rem; color: var(--text-secondary);"><strong>Service:</strong> ${getCategoryName(request.service_category)}</p>
                        <p style="margin-bottom: 0.5rem; color: var(--text-secondary);"><strong>Urgency:</strong> ${request.urgency}</p>
                        ${costHtml}
                        <p style="margin-bottom: 1rem; color: var(--text-secondary);">Submitted: ${request.created_at ? new Date(request.created_at).toLocaleString() : 'N/A'}</p>
                        <p style="color: var(--text-primary); margin-bottom: 1rem;">Our team is processing your request.</p>
                        ${adminResponseHtml}
                    `;
                } else {
                    resultDiv.innerHTML = `<p style="color: #e11d48; padding: 1rem; background: #fff1f2; border-radius: 8px; border: 1px solid #fda4af;">No request found for: <strong>${statusId}</strong></p>`;
                }
            } catch (error) {
                console.error('Error:', error);
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `<p style="color: #e11d48; padding: 1rem; background: #fff1f2; border-radius: 8px; border: 1px solid #fda4af;">Error checking status. Please try again later.</p>`;
            } finally {
                checkBtn.disabled = false;
                checkBtn.innerText = 'Check Status';
            }
        }

        function getStatusClass(status) {
            const statusLower = (status || '').toLowerCase();
            if (statusLower === 'submitted' || statusLower === 'under review') return 'status-pending';
            if (statusLower === 'approved' || statusLower === 'in progress') return 'status-online';
            if (statusLower === 'completed') return 'status-online';
            if (statusLower === 'rejected') return 'status-offline';
            return 'status-pending';
        }

        function getCategoryName(value) {
            const categories = {
                'gsm_gateway': 'GSM/PSTN Gateway Devices',
                'ucm_server': 'Grandstream UCM Servers',
                'handsets': 'VoIP Handsets',
                'conference_equipment': 'Conference Room Equipment',
                'call_cards': 'External Call Cards',
                'ivr': 'IVR (Interactive Voice Response)',
                'call_recording': 'Call Recording',
                'analytics': 'Call Analytics & Reporting',
                'queue_management': 'Queue Management',
                'omnichannel': 'Omnichannel Contact Center',
                'whatsapp': 'WhatsApp Business Integration',
                'telegram': 'Telegram Integration',
                'sms_gateway': 'Bulk SMS Gateway',
                'email_integration': 'Email Integration',
                'social_media': 'Social Media Integration',
                'service_quote': 'Service Quotation',
                'hardware_quote': 'Hardware Quotation',
                'invoice': 'Invoice Request',
                'custom_quote': 'Custom Solution Quote',
                'training': 'Training Request',
                'consultation': 'Technical Consultation',
                'custom': 'Custom Request'
            };
            return categories[value] || value;
        }
    </script>

    <!--Start of Tawk.to Script-->
    <script type="text/javascript">
        var Tawk_API = Tawk_API || {}, Tawk_LoadStart = new Date();
        (function () {
            var s1 = document.createElement("script"), s0 = document.getElementsByTagName("script")[0];
            s1.async = true;
            s1.src = 'https://embed.tawk.to/67694e7eaf5bfec1dbdaa0f7/1ifpfr0u3';
            s1.charset = 'UTF-8';
            s1.setAttribute('crossorigin', '*');
            s0.parentNode.insertBefore(s1, s0);
        })();
    </script>
    <!--End of Tawk.to Script-->

</body>

</html>